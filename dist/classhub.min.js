function classesService(a,b){function c(a){var b=a.filter(function(a){return"Unenrolled"!=a.PaymentStatus}).reduce(function(a,b){return a+parseInt(b.Number)},0);return b}function d(a,b){return a>=b}var e=this,f=a.classes.query();f.$promise.then(function(a){earliestDate()}),e.get=function(){return f},e.addClass=function(b){newclass=a.classes.save({title:b}),newclass.$promise.then(function(a){f.push(newclass)})},e.getClass=function(a){return getByID(a)},e.removeClass=function(b){var c=getIndex(b);console.log(c),title=f[c].title||"No Title",response=confirm("Delete "+title+"?"),response&&(f.splice(c,1),a.classes.delete({id:b}))},e.updateClass=function(b){var c=b.id;getIndex(c);a.classes.update({id:c},b)},e.addSession=function(b){"undefined"==typeof b.sessions&&(b.sessions=[]),newId=a.id.get(),newId.$promise.then(function(a){newSession={class:b.id,id:newId.id},b.sessions.push(newSession),e.update(b)})},e.removeSession=function(a,b){title=a.sessions[b].title,response=confirm("Delete "+title+"?"),response&&(a.sessions.splice(b,1),e.update(a))},e.getParticipants=function(a,e){angular.forEach(e,function(e){var f=a+"#"+e.id,g=new b(f);e.participants=g.get(),e.participants.$promise.then(function(a){e.totalSize=c(e.participants),e.waitlist=d(e.totalSize,e.size)})})},dateObject=function(a){return new Date(a)},dateTime=function(a){return a.getTime()},getByID=function(a){var b=f.find(function(b){return b.id===a});return b},getIndex=function(a){for(var b=0;b<f.length;b++)if(f[b].id===a)return b},e.types=["Class","Workshop","Open Studio","Private"],earliestDate=function(){f.forEach(function(a){a.earliestDate=1/0,"undefined"!=typeof a.sessions&&a.sessions.forEach(function(b){!b.disabled&b.date<a.earliestDate&&(a.earliestDate=b.date)})})}}function participantsFactory(a){console.log("participantsFactory");var b=function(b){return new participantsFactoryService(b,a)};return b}function participantsFactoryService(a,b){var c=this;c.id=a;var d=b.participants.query({coursesession:a});c.get=function(){return d}}function RegistrationService(){var a=this;a.newRegistration=function(b,c){c=a._addClassInfo(b,c);var d=a._newStatus(b.session.waitlist);return c=a._updateRegistration(c,d)},a._addClassInfo=function(a,b){return b.CourseSession=a.id+"#"+a.session.id,b.Cost=a.price,b.ClassName=a.title,b.Date=a.session.date,b.Type=a.type,b},a._newStatus=function(a){var b;return b=a?"Wait List":"Registered"},a._calcDueDate=function(a,b,c){var d=Date.now(),e=a-24*b*3600*1e3;return d>e&&(e=d+24*c*3600*1e3,e>a&&(e=a),e<d&&(e=d)),e},a._updateStatus=function(b,c){var d,e=b.Date,f=b.Number;switch(b.EmailFlag=!1,c){case"Wait List":b.EmailFlag=!0,b.Template=3,b.DueDate=0,b.Payment=0;break;case"Registered":b.EmailFlag=!0,"Class"===b.Type?(b.Template=2,b.Payment=50*f,d=a._calcDueDate(e,45,3),b.DueDate=d):"Workshop"===b.Type&&(b.Template=4,b.Payment=b.Cost*f,d=a._calcDueDate(e,14,2),b.DueDate=d),"Wait List"===b.PaymentStatus?b.Message="Yay, a space has opened up and you are now registered for":b.Message="Thank you for registering for";break;case"Overdue":b.EmailFlag=!0,b.Template=6,d=a._calcDueDate(e,5,5),b.DueDate=d;break;case"Confirmed":break;case"Unenrolled":b.EmailFlag=!0,b.Template=8}return b.PaymentStatus=c,b}}angular.module("classhub",["data","constants"]),angular.module("constants",[]),angular.module("data",["constants","ngResource"]),angular.module("classhub").service("classesService",classesService),classesService.$inject=["dataFactory","participantsFactory"],angular.module("data").service("dataFactory",["$http","API","$resource",function(a,b,c){this.participants=c(b.URL+b.STAGE+"/participants/:coursesession/:emailaddress",{coursesession:"@coursesession",emailaddress:"@emailaddress"},{update:{method:"PATCH"}}),this.classes=c(b.URL+b.STAGE+"/classes/:id",{id:"@id"},{update:{method:"PATCH"}}),this.contact=c(b.URL+b.STAGE+"/contact"),this.id=c(b.URL+b.STAGE+"/id"),this.getCategories=function(){return a.get("categories.json")},this.getClasses=function(){return a.get("classes.json")},this.getClass=function(b){return a.get(b+".json")},this.getSessions=function(){return a.get("sessions.json")},this.getParticipants=function(){return a.get(b.URL+b.STAGE+"/participants")}}]),angular.module("classhub").factory("participantsFactory",participantsFactory),participantsFactory.$inject=["dataFactory"],angular.module("classhub").service("registrationService",RegistrationService),angular.module("constants").constant("API",{URL:"https://7ryzk48yuc.execute-api.eu-central-1.amazonaws.com/",STAGE:"dev"}).constant("STATUS",{OPTIONS:["Registered","Confirmed","Wait List","Overdue","Unenrolled","Delete"]});